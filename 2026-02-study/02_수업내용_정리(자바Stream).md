# 자바 Stream

<br>

## 1. 명령형 vs 선언형 (제어문 vs 스트림)

**제어문: 명령형 (방법을 일일이 제시)**   

→ 직관적이고 자유도가 높지만 코드가 복잡해지면 의도를 파악하기 어렵고 에러가 날 가능성이 높아진다. 

**스트림: 선언형 (원하는 결과만 언급)**  

→ 하고 싶은 걸 언급하고 실행은 자바가 알아서 해준다. 코드 의도를 더 명확히 할 수 있고 실수 확률이 줄어든다. 

> **제어문이란?**  
프로그램이 위 → 아래의 흐름대로 순차적으로 실행될 때, **조건에 따라 특정 코드를 선택적으로 실행하거나 반복적으로 실행하도록 제어하는 명령문**으로 프로그램의 논리와 효율성을 결정하는 핵심적인 역할을 한다.  
크게 **조건문**(if, switch 등)과 **반복문**(for, while 등), 그리고 반복을 제어하는 **분기문**(break, continue 등)으로 나뉜다.

<br>

## 2. 메서드 레퍼런스 (`::`)

- JVM의 메서드 영역에 이미 정의되어 있는 메서드를 이름으로 참조한다.

```jsx
Arrays.stream(arr) // 함수 그 자체를 넘겨줌
                .forEach(System.out::println); // 함수를 실행
```

`함수` → 함수 그 자체

`함수();` → 함수 실행

`소유자 :: 메서드명`

소유자: 클래스명 또는 객체 참조 변수명

스트림에 메서드 레퍼런스를 넘기면 해당 메서드를 대신 사용해준다. *일반적으로 스트림에 넘기는 메서드의 매개변수는 1개다.*

<br>

## 3. 람다 함수 = 이름 없는 익명 함수, 일회성 함수

```java
() → {}
```

람다는 **이름 없는 익명 함수(Anonymous Function)**를 뜻하며, 함수를 간결하게 정의하여 일회성으로 사용할 때 활용되는 개념이다.

**일회성 함수를 밖에서 생성한 다음 대입하지 않고 스트림에서 바로 만들어서 쓸 수 있게 한다.** 코드 양을 줄이고 가독성을 높여 콜백 함수나 데이터 처리 스트림에서 주로 사용한다. 단, 재사용성이 높거나 복잡한 코드는 함수로 정의해서 사용하는 것이 좋다. 

*함수형 인터페이스를 구현한 ‘객체’이다.* 

+) `.formatted()` 설명

`String intro = “안녕하세요 %d살 %s입니다.”.formatted(age, name);`

- `%d`: 정수 (digit)
- `%s`: 문자열 (string)
- `%f`: 실수 (float)

<br>

## 4. 자주 사용되는 스트림 문법

스트림이라는 거대한 반복문 중 자주 사용되는 문법

- `.filter(…)` : if문의 용도, 조건O → true일 때만 다음 줄로 넘어간다
    - Trace Current Stream Chain(인텔리제이 디버거 기능)을 이용해서 스트림의 중간 연산 과정에서 데이터가 어떻게 변하는지를 시각적으로 확인할 수 있다.
- `.map(…)` : 들어오고 나가는 ‘개수’는 동일
- 스트림은 원본 데이터를 변형하지 않고 가공된 데이터를 바탕으로 새로운 결과값을 생성해서 준다.

**중간 연산 → 스트림 유지**

- 예) filter()

**최종 연산 → 스트림 종료**

- 종단 함수는 스트림이 종료되었을 때의 최종 결과이므로 반드시 필요하다.
- 예) collect, forEach, toArray ..
- 스트림으로 다시 반환되는 함수만 스트림 체이닝이 가능하다. 반환이 없는 forEach나 배열을 반환하는 toArray는 종단 함수라 스트림 유지가 안된다.

<br>

## 5. 기본형 스트림과 변환(Mapping)

자바 스트림은 데이터 타입에 따라 크게 두 가지로 나눌 수 있다. 

1. **일반 객체 스트림 (`Stream<T>`)**: `String`, `User`, `Integer` 등 객체를 다룸.
2. **기본형 특화 스트림 (`IntStream`, `LongStream` 등)**: 숫자 계산에 특화됨.

**map 메서드 → 스트림의 형태를 변환해줌**

- `.map()`: 객체 → 다른 객체로 변환 (Stream<T> → Stream<T>)
- `.mapToInt()`: 객체 → 숫자로 변환 (Stream<T> → IntStream)
    - 문자, 사람 스트림 → 합/평균/최대/최소 X
    - 숫자 스트림 → 합/평균/최대/최소 O
- `.mapToObj()` : 숫자 → 객체로 변환 (IntStream → Stream<T>)
    - 문자 처리는 숫자 스트림에서 할 수 없으므로 객체 스트림(Object Stream)으로 바꾸고 진행해야 한다.

- `Stream<Integer>` vs `IntStream`
    - 전자는 객체를 다루고, 후자는 기본형 int를 다룬다.
- 리스트는 stream이라는 메서드를 내장하고 있다 (cf. 배열)

<br>

## 6. Optional

- 스트림의 최종 연산(종단 함수) 중 일부가 결과를 Optional로 반환한다.
- Optional은 **자바에서 결과의 null처리를 문법적으로 강제하기 위해 도입한 자료형**이다.

스트림을 통해서 결과를 뽑아낼 때 객체 하나가 나올 때? 아니면 없어서 null이 나올 때 optional 사용

```java
p1.getAge(); //null인지 아닌지 직접 판별 불가

if(p1 != null) {
	p1.getAge(); 
}
// 매번 예외처리 하는 게 번거롭고 실수할 가능성

Optional<Person> p1 = Optional.empty();

if (p1.isEmpty()) { 
    System.out.println("사람 정보가 없습니다.");
}

if (p1.isPresent()) {
    Person person = p1.get();
    System.out.println(person.getName());
}
```

<br>